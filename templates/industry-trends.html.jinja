{% extends "layout.html.jinja" %}

{% block main %}
    <h1 class="text-4xl font-bold mb-4">Trend Following</h1>
    <form method="get" action="/industry-trends/results" class="max-w-[30rem] grid grid-cols-[auto_1fr] gap-y-2 gap-x-4 items-center mb-6">
{#        <label for="user">User*</label>#}
{#        <input id="user" name="user" type="text" required value="{{ user if user else '' }}">#}

        <label for="start_date">Start Date*</label>
        <input id="start_date" name="start_date" type="date" value="2020-01-01" required>

        <label for="end_date">End Date*</label>
        <input id="end_date" name="end_date" type="date" value="2025-06-01" required>

        <label for="initial_balance">Initial Amount*</label>
        <input id="initial_balance" name="initial_balance" type="number" step=".01" value="100000" required>

        <label for="tickers">Tickers*</label>
        <select id="tickers" name="tickers" multiple required>
            {% for etf in etfs %}
                <option value="{{ etf }}">{{ etf }}</option>
            {% endfor %}
        </select>

        <label for="up_period">Upper band period (days)*</label>
        <input id="up_period" name="up_period" type="number" min="1" value="20" required>

        <label for="down_period">Lower band period (days)*</label>
        <input id="down_period" name="down_period" type="number" min="1" value="40" required>

        <label for="max_leverage">Max Leverage (%)*</label>
        <input id="max_leverage" name="max_leverage" type="number" min="100" value="200" step="0.01" required>

        <label for="target_volatility">Target Volatility (%)*</label>
        <input id="target_volatility" name="target_volatility" type="number" min="0" value="1.5" step="0.01" required>

        <label for="rebalance_threshold">Rebalance Threshold (%)*</label>
        <input id="rebalance_threshold" name="rebalance_threshold" type="number" min="0" value="10" step="0.01" required>

        <label for="trade_cost_per_share">Cost per share ($)*</label>
        <input id="trade_cost_per_share" name="trade_cost_per_share" type="number" min="0" value="0.0035" step="0.00001" required>

        <label for="trade_cost_min">Min trade cost ($)*</label>
        <input id="trade_cost_min" name="trade_cost_min" type="number" min="0" value="0.35" step="0.00001" required>

        <button>Compute</button>
    </form>

    {% if results %}
        <div id="chart-container" class="w-full h-[25rem]"></div>

        <script type="module">
            import '/static/dist/chart.js';

            const portfolio = {{ balance.to_json(orient='split')|safe }};
            setupIndustryTrendsChart(document.getElementById('chart-container'), portfolio);
        </script>
    {% endif %}
{% endblock %}